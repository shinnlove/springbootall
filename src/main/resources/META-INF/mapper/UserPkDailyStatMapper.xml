<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shinnlove.springbootall.db.dao.UserPkDailyStatRepo">

    <insert id="insertUserDailyStat" useGeneratedKeys="true" keyProperty="entity.id">
        insert into ${tableName} (activity_id, guid, chance_count,
                                  success_count, failure_count, stat_date)
        values (
                   #{entity.activityId,jdbcType=VARCHAR},
                   #{entity.guid,jdbcType=BIGINT},
                   #{entity.chanceCount,jdbcType=INTEGER},
                   #{entity.successCount,jdbcType=INTEGER},
                   #{entity.failureCount,jdbcType=INTEGER},
                   #{entity.statDate,jdbcType=INTEGER}
               )
            ON DUPLICATE KEY
        UPDATE chance_count = #{entity.chanceCount};
    </insert>

    <select id="queryUserDailyPk" resultType="com.shinnlove.springbootall.db.po.UserPkDailyStatEntity">
        SELECT id, activity_id, guid,
               chance_count, success_count, failure_count,
               stat_date, create_time, update_time
        FROM ${tableName}
        WHERE `activity_id` = #{activityId} AND `guid` = #{guid}
          AND `stat_date` = #{statDate}
        ORDER BY `create_time` DESC
    </select>

    <update id="updateDailySuccess">
        UPDATE ${tableName}
        SET `success_count` = `success_count` + 1
        WHERE `activity_id` = #{activityId} AND `guid` = #{guid}
    </update>

    <update id="incDailyFailure">
        UPDATE ${tableName}
        SET `failure_count` = `failure_count` + 1
        WHERE `activity_id` = #{activityId} AND `guid` = #{guid}
    </update>

    <update id="incDailyDraw">
        UPDATE ${tableName}
        SET `draw_count` = `draw_count` + 1
        WHERE `activity_id` = #{activityId} AND `guid` = #{guid}
    </update>

    <update id="incDailyChance">
        UPDATE ${tableName}
        SET `chance_count` = `chance_count` + 1
        WHERE `activity_id` = #{activityId} AND `guid` = #{guid}
    </update>

</mapper>
