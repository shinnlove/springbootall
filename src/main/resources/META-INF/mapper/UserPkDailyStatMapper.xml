<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shinnlove.springbootall.db.dao.UserPkDailyStatRepo">

    <insert id="insertUserDailyStat" useGeneratedKeys="true" keyProperty="entity.id">
        insert into ${tableName} (activity_id, guid, chance_count,
                                  success_count, failure_count, stat_date)
        values (
                   #{activity_id,jdbcType=VARCHAR},
                   #{guid,jdbcType=BIGINT},
                   #{chance_count,jdbcType=INT},
                   #{success_count,jdbcType=INT},
                   #{failure_count,jdbcType=INT}
               )
            ON DUPLICATE KEY UPDATE
            chance_count = #{entity.chanceCount};
    </insert>

  <select id="queryUserDailyPk" resultType="com.shinnlove.springbootall.db.po.UserPkDailyStatEntity">
    SELECT id, activity_id, guid,
           chance_count, success_count, failure_count,
           stat_date, create_time, update_time
    FROM ${tableName}
    WHERE `guid` = #{guid}
    AND `stat_date` = #{statDate}
    ORDER BY `create_time` DESC
  </select>

    <update id="updateDailySuccess">
        UPDATE ${tableName}
        SET `success_count` = `success_count` + 1
        WHERE `guid` = #{guid}
    </update>

    <update id="updateDailyFailure">
        UPDATE ${tableName}
        SET `failure_count` = `failure_count` + 1
        WHERE `guid` = #{guid}
    </update>

    <update id="updateDailyDraw">
        UPDATE ${tableName}
        SET `draw_count` = `draw_count` + 1
        WHERE `guid` = #{guid}
    </update>

    <update id="updateDailyChance">
        UPDATE ${tableName}
        SET `chance_count` = `chance_count` + 1
        WHERE `guid` = #{guid}
    </update>

</mapper>
